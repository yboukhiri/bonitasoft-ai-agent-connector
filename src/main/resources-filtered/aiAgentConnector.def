<?xml version="1.0" encoding="UTF-8"?>
<definition:ConnectorDefinition xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:definition="http://www.bonitasoft.org/ns/connector/definition/6.1">
    
    <!-- ═══════════════════════════════════════════════════════════════════════════
         CONNECTOR IDENTIFICATION
         ═══════════════════════════════════════════════════════════════════════════ -->
    <id>${connector-definition-id}</id>
    <version>${connector-definition-version}</version>
    <icon>connector.png</icon>
    <category icon="connector.png" id="AI"/>
    
    <!-- ═══════════════════════════════════════════════════════════════════════════
         CONNECTOR INPUTS
         
         All inputs support process variable expressions (e.g., ${processVariableName}).
         Values can be entered directly or referenced from process variables.
         
         RAG Agent API Contract:
         - agentUrl: Agent API endpoint URL
         - authToken: JWT Bearer token for authentication
         - question: The question to ask the RAG agent
         - llmApiKey: OpenAI/Anthropic API key
         - llmModel: LLM model name (default: gpt-4o-mini)
         - topK: Documents to retrieve, 1-10 (default: 3)
         - minConfidence: Confidence threshold, 0.0-1.0 (default: 0.0)
         - requireSources: Include sources in response (default: true)
         - timeoutMs: Request timeout in milliseconds (default: 30000)
         - maxTokens: Max response tokens (default: 700)
         - temperature: LLM temperature (default: 0.1)
         ═══════════════════════════════════════════════════════════════════════════ -->
    
    <!-- Agent API URL: The endpoint URL for the RAG agent (supports process variable expressions) -->
    <input mandatory="true" name="agentUrl" type="java.lang.String"/>
    
    <!-- Auth Token: JWT Bearer token for authentication (supports process variable expressions, can be empty if auth disabled) -->
    <input mandatory="false" name="authToken" type="java.lang.String"/>
    
    <!-- Question: The question to ask the RAG agent (mandatory, supports process variable expressions) -->
    <input mandatory="true" name="question" type="java.lang.String"/>
    
    <!-- LLM API Key: OpenAI/Anthropic API key (mandatory, supports process variable expressions) -->
    <input mandatory="true" name="llmApiKey" type="java.lang.String"/>
    
    <!-- LLM Model: Model name (default: gpt-4o-mini) -->
    <input mandatory="false" name="llmModel" type="java.lang.String"/>
    
    <!-- Top K: Number of documents to retrieve (default: 3, range: 1-10) -->
    <input mandatory="false" name="topK" type="java.lang.Integer"/>
    
    <!-- Min Confidence: Confidence threshold (default: 0.0, range: 0.0-1.0) -->
    <input mandatory="false" name="minConfidence" type="java.lang.Double"/>
    
    <!-- Require Sources: Include sources in response (default: true) -->
    <input mandatory="false" name="requireSources" type="java.lang.Boolean"/>
    
    <!-- Timeout: Request timeout in milliseconds (default: 30000, range: 1000-300000) -->
    <input mandatory="false" name="timeoutMs" type="java.lang.Integer"/>
    
    <!-- Max Tokens: Maximum response tokens (default: 700, range: 100-4000) -->
    <input mandatory="false" name="maxTokens" type="java.lang.Integer"/>
    
    <!-- Temperature: LLM temperature for response generation (default: 0.1, range: 0.0-2.0) -->
    <input mandatory="false" name="temperature" type="java.lang.Double"/>
    
    <!-- ═══════════════════════════════════════════════════════════════════════════
         CONNECTOR OUTPUTS
         
         Response contract:
         - status: ok | low_confidence | error
         - answer: The agent's answer text
         - sources: List of source documents used
         - confidence: Confidence score (0.0-1.0)
         - reasoning: Explanation of how the answer was derived
         - errorCode: Error code if status=error
         - errorMessage: Human-readable error message if status=error
         ═══════════════════════════════════════════════════════════════════════════ -->
    
    <!-- Status: Response status from the agent (ok, low_confidence, or error) -->
    <output name="status" type="java.lang.String"/>
    
    <!-- Answer: The agent's answer text -->
    <output name="answer" type="java.lang.String"/>
    
    <!-- Sources: List of source documents used (List of Maps with title/version) -->
    <output name="sources" type="java.util.List"/>
    
    <!-- Confidence: Confidence score (0.0-1.0) -->
    <output name="confidence" type="java.lang.Double"/>
    
    <!-- Reasoning: Explanation of how the answer was derived -->
    <output name="reasoning" type="java.lang.String"/>
    
    <!-- Error Code: Error code if the request failed (e.g., VALIDATION_ERROR, LLM_ERROR) -->
    <output name="errorCode" type="java.lang.String"/>
    
    <!-- Error Message: Human-readable error message if the request failed -->
    <output name="errorMessage" type="java.lang.String"/>
    
    <!-- ═══════════════════════════════════════════════════════════════════════════
         CONNECTOR UI PAGES
         
         Page definitions for Bonita Studio wizard UI.
         Each widget is bound to an input via inputName attribute.
         ═══════════════════════════════════════════════════════════════════════════ -->
    
    <!-- Page 1: Connection Settings -->
    <!-- All widgets support expressions to reference process variables (e.g., ${agentUrl}, ${authToken}, ${llmApiKey}) -->
    <page id="connectionPage">
        <widget xsi:type="definition:Text" id="agentUrlWidget" inputName="agentUrl"/>
        <widget xsi:type="definition:Text" id="authTokenWidget" inputName="authToken"/>
        <widget xsi:type="definition:Text" id="llmApiKeyWidget" inputName="llmApiKey"/>
    </page>
    
    <!-- Page 2: Query Settings -->
    <page id="queryPage">
        <widget xsi:type="definition:Text" id="questionWidget" inputName="question"/>
        <widget xsi:type="definition:Text" id="llmModelWidget" inputName="llmModel"/>
    </page>
    
    <!-- Page 3: Advanced Settings -->
    <page id="advancedPage">
        <widget xsi:type="definition:Text" id="topKWidget" inputName="topK"/>
        <widget xsi:type="definition:Text" id="minConfidenceWidget" inputName="minConfidence"/>
        <widget xsi:type="definition:Text" id="requireSourcesWidget" inputName="requireSources"/>
        <widget xsi:type="definition:Text" id="timeoutMsWidget" inputName="timeoutMs"/>
        <widget xsi:type="definition:Text" id="maxTokensWidget" inputName="maxTokens"/>
        <widget xsi:type="definition:Text" id="temperatureWidget" inputName="temperature"/>
    </page>
    
</definition:ConnectorDefinition>
